before_script:
    - env | sort



deploy:
  stage: deploy
  script:
    - sudo rsync -a --delete /opt/waqf/storage /tmp
    - sudo rm -rf /opt/waqf
    - sudo rm -rf .git
    - sudo mkdir -p /opt/waqf
    - sudo cp -rf . /opt/waqf
    - sudo rsync -a /tmp/storage/. /opt/waqf/storage/
    - ls -la
    - sudo cp .env.dev /opt/waqf/.env
    - cd /opt/waqf
    - export PWD=$(pwd)
    - echo $PWD
    - sudo chown -R 1000:1001 /opt/waqf
    - docker-compose -f docker-compose-server.yml up -d --build --force-recreate
    - echo 'Successfully deploy'
  tags:
    - shell-dev
  only:
    - develop
    - devops/cicd
